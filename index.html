<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Verificador de Mensagem PGP</title>
</head>
<body>
    <h1>Verificador de Mensagem PGP</h1>
    <textarea id="inputText" rows="10" cols="60" placeholder="Cole a mensagem com a assinatura PGP aqui"></textarea><br><br>
    <button id="verifyBtn">Verificar Assinatura</button>
    <p id="result"></p>
    
    <!-- Carregamento do arquivo local openpgp.min.js como script global -->
    <script src="openpgp.min.js"></script>
    
    <script>
        // Verificação se a biblioteca foi carregada corretamente
        if (typeof openpgp === 'undefined') {
            document.getElementById('result').textContent = 'Erro: Biblioteca OpenPGP não carregada. Verifique o caminho do arquivo openpgp.min.js.';
            throw new Error('OpenPGP não disponível');
        }
        
        // Chave pública embutida (certifique-se de que está completa; a fornecida parece truncada)
        const pubKeyArmored = `-----BEGIN PGP PUBLIC KEY BLOCK-----
        
mDMEaOWjfhYJKwYBBAHaRw8BAQdALLFofYkhzgT7mLc6hDUvhErkAdgVVG2ssKvd
ErvKkN60G0d1eXJhc3UgPGd1eXJhc3VAZ21haWwuY29tPoiTBBMWCgA7FiEEQiQ5
jHPxpgf5mv6ZHlXjLOTQ8pkFAmjlo34CGwMFCwkIBwICIgIGFQoJCAsCBBYCAwEC
HgcCF4AACgkQHlXjLOTQ8pnyZAEApwdVGZ2AJIWFfh44Qj3PanME4/tN8vtgw/QE
PC2oMGgA/j5M1uRc6N55/x3lJDWdjFwjK+Gc5ens6K9LSevGi68BuDgEaOWjfhIK
KwYBBAGXVQEFAQEHQLvRf6r+GI9vHGQUK0T4aL41v2PlVle17QER61BLvj1VAwEI
B4h4BBgWCgAgFiEEQiQ5jHPxpgf5mv6ZHlXjLOTQ8pkFAmjlo34CGwwACgkQHlXj
LOTQ8pluvgD/TyBqzHOZNbQbSbGEK9+U7expuUDdIrtyX5MrqaLHxFUBAK8mrjWM
kEIa9EoYr8JEnX+VFP+Gt67cZUgkCcdC7TIL
=uR1x
-----END PGP PUBLIC KEY BLOCK-----`;
        
        document.getElementById('verifyBtn').addEventListener('click', async () => {
            const input = document.getElementById('inputText').value;
            const signatureStart = input.indexOf('-----BEGIN PGP SIGNATURE-----');
            if (signatureStart === -1) {
                document.getElementById('result').textContent = "Assinatura não encontrada!";
                return;
            }
            const messageText = input.substring(0, signatureStart).trim();
            const signatureArmored = input.substring(signatureStart).trim();
            try {
                const publicKey = await openpgp.readKey({ armoredKey: pubKeyArmored });
                const signature = await openpgp.readSignature({ armoredSignature: signatureArmored });
                const message = await openpgp.createMessage({ text: messageText });
                const verificationResult = await openpgp.verify({
                    message,
                    signature,
                    verificationKeys: publicKey
                });
                
                // Verificação da Promise 'verified' com try/catch para compatibilidade com v6.x
                const { verified } = verificationResult.signatures[0];
                try {
                    await verified;
                    document.getElementById('result').textContent = "✅ Assinatura válida!";
                } catch (verificationError) {
                    document.getElementById('result').textContent = "❌ Assinatura inválida: " + verificationError.message;
                }
            } catch (err) {
                document.getElementById('result').textContent = "Erro: " + err.message;
            }
        });
    </script>
</body>
</html>